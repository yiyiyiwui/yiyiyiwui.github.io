<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MQ | 我的博客</title>
    <meta name="description" content="德智体美劳全面发展">
    <meta name="generator" content="VitePress v2.0.0-alpha.12">
    <link rel="preload stylesheet" href="/assets/style.CZvPc2EJ.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.DUD75REu.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.DpYtQAvY.js">
    <link rel="modulepreload" href="/assets/chunks/framework.kZi0S3Z0.js">
    <link rel="modulepreload" href="/assets/java_mq.md.6nIMkIhz.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1df9f90f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-1df9f90f data-v-9f75dce3><div class="VPNavBar" data-v-9f75dce3 data-v-2a96a3d0><div class="wrapper" data-v-2a96a3d0><div class="container" data-v-2a96a3d0><div class="title" data-v-2a96a3d0><div class="VPNavBarTitle has-sidebar" data-v-2a96a3d0 data-v-1e38c6bc><a class="title" href="/" data-v-1e38c6bc><!--[--><!--]--><!----><span data-v-1e38c6bc>我的博客</span><!--[--><!--]--></a></div></div><div class="content" data-v-2a96a3d0><div class="content-body" data-v-2a96a3d0><!--[--><!--]--><div class="VPNavBarSearch search" data-v-2a96a3d0><!--[--><!----><div id="local-search"><button type="button" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-2a96a3d0 data-v-39714824><span id="main-nav-aria-label" class="visually-hidden" data-v-39714824> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-39714824 data-v-e56f3d57><!--[--><span data-v-e56f3d57>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/admin/my.html" tabindex="0" data-v-39714824 data-v-e56f3d57><!--[--><span data-v-e56f3d57>关于</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/utils/index.html" tabindex="0" data-v-39714824 data-v-e56f3d57><!--[--><span data-v-e56f3d57>潘多拉</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/java/index.html" tabindex="0" data-v-39714824 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Java</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/linux/index.html" tabindex="0" data-v-39714824 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Linux</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-39714824 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-42cb505d><span class="text" data-v-42cb505d><!----><span data-v-42cb505d>组件</span><span class="vpi-chevron-down text-icon" data-v-42cb505d></span></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><div class="items" data-v-25a6cce8><!--[--><!--[--><div class="VPMenuLink" data-v-25a6cce8 data-v-cd834e02><a class="VPLink link" href="/dev/mysql.html" data-v-cd834e02><!--[--><span data-v-cd834e02>MySql</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-25a6cce8 data-v-cd834e02><a class="VPLink link" href="/dev/nginx.html" data-v-cd834e02><!--[--><span data-v-cd834e02>Nginx</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-25a6cce8 data-v-cd834e02><a class="VPLink link" href="/dev/redis.html" data-v-cd834e02><!--[--><span data-v-cd834e02>Redis</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-25a6cce8 data-v-cd834e02><a class="VPLink link" href="/dev/docker.html" data-v-cd834e02><!--[--><span data-v-cd834e02>Docker</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-2a96a3d0 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-2a96a3d0 data-v-0394ad82 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-2a96a3d0 data-v-bb2aa2f0 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-42cb505d><span class="vpi-more-horizontal icon" data-v-42cb505d></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-2a96a3d0 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-2a96a3d0><div class="divider-line" data-v-2a96a3d0></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-1df9f90f data-v-8acdfeb5><div class="container" data-v-8acdfeb5><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-8acdfeb5><span class="vpi-align-left menu-icon" data-v-8acdfeb5></span><span class="menu-text" data-v-8acdfeb5>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-8acdfeb5 data-v-0bf0e06f><button data-v-0bf0e06f>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-1df9f90f data-v-e7c6e512><div class="curtain" data-v-e7c6e512></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-e7c6e512><span class="visually-hidden" id="sidebar-aria-label" data-v-e7c6e512> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0 collapsible has-active" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>概览</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-d81de50c><span class="vpi-chevron-right caret-icon" data-v-d81de50c></span></div></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/java.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>Java基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/openSource.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>开源框架</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/mp.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>MybatisPlus</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/springCloud.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>SpringCloud</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/webSocket.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>WebSocket</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/springCache.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>SpringCache</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/bitmap.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>位图</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/spring.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>Spring</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/mqtt.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>MQTT</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/springTask.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>SpringTask</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/es.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>ES</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/dt.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>分布式事务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/project.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>Java项目</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/mq.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>MQ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/java/mybatis.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>Mybatis</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1df9f90f data-v-aff0b8d7><div class="VPDoc has-sidebar has-aside" data-v-aff0b8d7 data-v-7011f0d8><!--[--><!--]--><div class="container" data-v-7011f0d8><div class="aside" data-v-7011f0d8><div class="aside-curtain" data-v-7011f0d8></div><div class="aside-container" data-v-7011f0d8><div class="aside-content" data-v-7011f0d8><div class="VPDocAside" data-v-7011f0d8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-60d5052e><div class="content" data-v-60d5052e><div class="outline-marker" data-v-60d5052e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-60d5052e>页面导航</div><ul class="VPDocOutlineItem root" data-v-60d5052e data-v-2d0bdf9b><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7011f0d8><div class="content-container" data-v-7011f0d8><!--[--><!--]--><main class="main" data-v-7011f0d8><div style="position:relative;" class="vp-doc _java_mq" data-v-7011f0d8><div><h1 id="mq" tabindex="-1">MQ <a class="header-anchor" href="#mq" aria-label="Permalink to “MQ”">​</a></h1><blockquote><p>每个微服务之间通信方式有两种，同步和异步，Feign就是基于http协议的同步通信方式，而MQ是微服务异步调用的方式。</p></blockquote><h2 id="先来个小案例" tabindex="-1">先来个小案例： <a class="header-anchor" href="#先来个小案例" aria-label="Permalink to “先来个小案例：”">​</a></h2><p>假设我们做了个12306系统，我们买票成功后，需要做以下几件事：调用库存系统扣减车票库存，调用短信系统给用户发送短信，调用邮件系统给用户发邮件，调用第三方客户端通知买票成功。那么如果这几个服务一直能正常服务，产品经理不在有新的需求变更，那也可称得上现世安稳，岁月静好。可是万一有一天出现这么两种情况可怎么办呢？</p><p>1：产品经理提需求，好多人关注了我们12306微信客户端，我们需要买票成功后在通知微信小程序。那么我们又需要修改订单系统的代码。一次还好，如果隔一段时间发生一件这样的事，那谁能忍受？</p><p>2： 某一天，短信系统挂了，然后客户成功买到一张票，然后呢是短信也没收到，邮件也没收到，库存也没扣，这还得了。你短信系统坏了，我邮件系统好好的，凭什么影响我，让客户收不到邮件，这就不合理。所以呢，还是各个系统之间的耦合太高了，我们应该解耦。这个时候我们就需要一个中间人来帮我们解决这个问题，那么我们看MQ如何帮我们解决这件棘手的事情。 <img src="/assets/46.E_uNdyaD.png" alt=""> 之前用Feign是这样的：同步调用 <img src="/assets/47.COPBO8X_.png" alt=""> 用了MQ后可以这样：异步调用</p><p>MQ（消息队列 ）是在消息的传输过程中保存消息的容器，就如上案例一样，我们可以来做一个中间的容器，你执行成功失败不会影响别的微服务系统运行 <img src="/assets/48.BJb7lB5c.png" alt=""><img src="/assets/49.DELme0yv.png" alt=""> 如上图所示，如果用户买了票，我这边可以告诉中间件Broker，然后MQ告诉其他需要执行的业务，其他业务只需要订阅Broker就可以收到消息。如果后面还有其他服务，只需要订阅Broker就可以了，不会影响其他代码的运行，删除也一样。 同时也提高了响应速度。</p><h3 id="注" tabindex="-1">注： <a class="header-anchor" href="#注" aria-label="Permalink to “注：”">​</a></h3><p>同步调用实效性强，可以直接得到结果，如果直接查询，需要实时性高，Feign比较好，比如我查询订单，你后台半天没返回数据，就会影响客户体验。但如果涉及相应的处理，并且复杂度比较高，或者后期变动情况比较大，还是推荐使用MQ异步，减少后期维护的麻烦，减轻重复工作的可能</p><h2 id="问题-如果多人访问-发送的请求多了怎么办" tabindex="-1">问题：如果多人访问，发送的请求多了怎么办？ <a class="header-anchor" href="#问题-如果多人访问-发送的请求多了怎么办" aria-label="Permalink to “问题：如果多人访问，发送的请求多了怎么办？”">​</a></h2><p>Broker中间是队列，可以帮你拦截，谁先买的票，先帮谁处理 <img src="/assets/50.CBwIwDrk.png" alt=""></p><h2 id="问题-mq的缺点是什么" tabindex="-1">问题：MQ的缺点是什么？ <a class="header-anchor" href="#问题-mq的缺点是什么" aria-label="Permalink to “问题：MQ的缺点是什么？”">​</a></h2><p><img src="/assets/51.-E5MR8Xb.png" alt=""> 最致命的却带你是假如中间MQ出现了宕机，其他系统也不能执行了。</p><p>而最常用的消息队列是RabbitMQ，RabbitMQ是基于AMQP的一款消息中间件管理系统</p><p>• <a href="https://www.rabbitmq.com/" target="_blank" rel="noreferrer">官网地址</a></p><p>首先在linux安装</p><p>下载镜像：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>docker pull rabbitmq:3.8-management</span></span></code></pre></div><p>安装MQ：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>docker run \</span></span>
<span class="line"><span> -v mq-plugins:/plugins \</span></span>
<span class="line"><span> --name=mq \</span></span>
<span class="line"><span> -p 15672:15672 \</span></span>
<span class="line"><span> -p 5672:5672 \</span></span>
<span class="line"><span> -d \</span></span>
<span class="line"><span> rabbitmq:3.8-management</span></span></code></pre></div><p>账号密码初始都是：guest 开发中咱们不会接触管理员用户，所以这里创建自己的用户 <img src="/assets/52.yLJktuIg.png" alt=""> 因为要用多个微服务，对应的也有数据库，为了更好区分，我们要隔离起来创建各自项目的虚拟主机 <img src="/assets/53.CjReuW2B.png" alt=""> 之后管理员给这个用户的虚拟主机分配权限</p><p>RabbitMQ消息队列主要分为两种，一种就类似于Feign，点对点模型。另一种是就是分布式的，发布/订阅模型 <img src="/assets/54.D2mYF80B.png" alt=""> 发布者发布消息后，我们通过交换机接收消息，然后传给队列，队列存储消息，然后再发给各个消费者，生产者能发多个消息，也可以有多个交换机接收，同样，交换机也可以发送多个消息给队列，队列也可以给多个消费者发送消息。</p><h2 id="问题-在mq中怎么和feign一样发送接收消息呢" tabindex="-1">问题：在MQ中怎么和Feign一样发送接收消息呢？ <a class="header-anchor" href="#问题-在mq中怎么和feign一样发送接收消息呢" aria-label="Permalink to “问题：在MQ中怎么和Feign一样发送接收消息呢？”">​</a></h2><p><img src="/assets/55.BCUrh-ez.png" alt=""> 1：首先我们先在生产方建立连接工厂，创建连接对象和通道</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>public void testSendMessage() throws IOException, TimeoutException {</span></span>
<span class="line"><span>    // 1.建立连接</span></span>
<span class="line"><span>    ConnectionFactory factory = new ConnectionFactory();</span></span>
<span class="line"><span>    // 1.1.设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span></span>
<span class="line"><span>    factory.setHost(&quot;192.168.200.130&quot;);</span></span>
<span class="line"><span>    factory.setPort(5672);</span></span>
<span class="line"><span>    factory.setVirtualHost(&quot;/quick&quot;);</span></span>
<span class="line"><span>    factory.setUsername(&quot;itheima&quot;);</span></span>
<span class="line"><span>    factory.setPassword(&quot;123456&quot;);</span></span>
<span class="line"><span>    // 1.2.建立连接</span></span>
<span class="line"><span>    Connection connection = factory.newConnection();</span></span>
<span class="line"><span>    // 2.创建通道Channel</span></span>
<span class="line"><span>    Channel channel = connection.createChannel();</span></span>
<span class="line"><span>    // 3.创建队列</span></span>
<span class="line"><span>    String queueName = &quot;simple.queue&quot;;</span></span>
<span class="line"><span>    channel.queueDeclare(queueName, false, false, false, null);</span></span>
<span class="line"><span>    // 4.发送消息</span></span>
<span class="line"><span>    String message = &quot;hello, rabbitmq!&quot;;</span></span>
<span class="line"><span>    channel.basicPublish(&quot;&quot;, queueName, null, message.getBytes());</span></span>
<span class="line"><span>    System.out.println(&quot;发送消息成功：【&quot; + message + &quot;】&quot;);</span></span>
<span class="line"><span>    // 5.关闭通道和连接</span></span>
<span class="line"><span>    channel.close();</span></span>
<span class="line"><span>    connection.close();</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>2 ：在消费者接收</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>public static void main(String[] args) throws IOException, TimeoutException {</span></span>
<span class="line"><span>       // 1.建立连接</span></span>
<span class="line"><span>       ConnectionFactory factory = new ConnectionFactory();</span></span>
<span class="line"><span>       // 1.1.设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span></span>
<span class="line"><span>       factory.setHost(&quot;192.168.200.130&quot;);</span></span>
<span class="line"><span>       factory.setPort(5672);</span></span>
<span class="line"><span>       factory.setVirtualHost(&quot;/quick&quot;);</span></span>
<span class="line"><span>       factory.setUsername(&quot;itheima&quot;);</span></span>
<span class="line"><span>       factory.setPassword(&quot;123456&quot;);</span></span>
<span class="line"><span>       // 1.2.建立连接</span></span>
<span class="line"><span>       Connection connection = factory.newConnection();</span></span>
<span class="line"><span>       // 2.创建通道Channel</span></span>
<span class="line"><span>       Channel channel = connection.createChannel();</span></span>
<span class="line"><span>       // 3.创建队列</span></span>
<span class="line"><span>       String queueName = &quot;simple.queue&quot;;</span></span>
<span class="line"><span>       channel.queueDeclare(queueName, false, false, false, null);</span></span>
<span class="line"><span>       // 4.订阅消息</span></span>
<span class="line"><span>       channel.basicConsume(queueName, true, new DefaultConsumer(channel){</span></span>
<span class="line"><span>           @Override</span></span>
<span class="line"><span>           public void handleDelivery(String consumerTag, Envelope envelope,</span></span>
<span class="line"><span>                                      AMQP.BasicProperties properties, byte[] body) throws IOException {</span></span>
<span class="line"><span>               // 5.处理消息</span></span>
<span class="line"><span>               String message = new String(body);</span></span>
<span class="line"><span>               System.out.println(&quot;接收到消息：【&quot; + message + &quot;】&quot;);</span></span>
<span class="line"><span>           }</span></span>
<span class="line"><span>       });</span></span>
<span class="line"><span>       System.out.println(&quot;消费者等待接收消息。。。。&quot;);</span></span>
<span class="line"><span>   }</span></span></code></pre></div><h2 id="问题-代码繁琐-有简化的吗" tabindex="-1">问题：代码繁琐，有简化的吗？ <a class="header-anchor" href="#问题-代码繁琐-有简化的吗" aria-label="Permalink to “问题：代码繁琐，有简化的吗？”">​</a></h2><p>Spring基于AMQP协议定义的一套API规范，提供了模板来发送和接收消息</p><p>1： 引入依赖</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>&lt;!--AMQP依赖，包含RabbitMQ--&gt;</span></span>
<span class="line"><span>        &lt;dependency&gt;</span></span>
<span class="line"><span>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>            &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span></span>
<span class="line"><span>        &lt;/dependency&gt;</span></span></code></pre></div><p>2：生产者：</p><p>添加配置文件</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>spring:</span></span>
<span class="line"><span>  rabbitmq:</span></span>
<span class="line"><span>    host: 192.168.200.130 # 主机名</span></span>
<span class="line"><span>    port: 5672 # 端口</span></span>
<span class="line"><span>    virtual-host: /quick # 虚拟主机</span></span>
<span class="line"><span>    username: itheima # 用户名</span></span>
<span class="line"><span>    password: 123456 # 密码</span></span></code></pre></div><p>代码：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>注入方法：</span></span>
<span class="line"><span>  @Autowired</span></span>
<span class="line"><span>  private RabbitTemplate rabbitTemplate;</span></span>
<span class="line"><span></span></span>
<span class="line"><span> public void test1(){</span></span>
<span class="line"><span>        //队列名称</span></span>
<span class="line"><span>        String queueName =&quot;simple.queue&quot;;</span></span>
<span class="line"><span>        //消息内容</span></span>
<span class="line"><span>        String msg = &quot;Hello World&quot;;</span></span>
<span class="line"><span>        //发送消息，这里的方法是把消息转换为字节，需要接收两个参数，向哪个队列发？ 发什么？</span></span>
<span class="line"><span>        rabbitTemplate.convertAndSend(queueName,msg);</span></span>
<span class="line"><span>    }</span></span></code></pre></div><p>消费者：</p><p>添加配置文件</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>spring:</span></span>
<span class="line"><span>  rabbitmq:</span></span>
<span class="line"><span>    host: 192.168.200.130 # 主机名</span></span>
<span class="line"><span>    port: 5672 # 端口</span></span>
<span class="line"><span>    virtual-host: /quick # 虚拟主机</span></span>
<span class="line"><span>    username: itheima # 用户名</span></span>
<span class="line"><span>    password: 123456 # 密码</span></span></code></pre></div><p>代码</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>//监听简单的消息</span></span>
<span class="line"><span>@RabbitListener(queues = &quot;simple.queue&quot;) //监听队列                           @RabbitListener(queuesToDeclare = @Queue(&quot;simple.queue&quot;)) // 如果mq中没有队列，就会创建</span></span>
<span class="line"><span>public void listenSimpleQueue(String msg) {</span></span>
<span class="line"><span>    System.out.println(&quot;接收消息：&quot;+msg);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h2 id="问题-如果生产者生产了10条消息-消费者不能一下子接收那么多消息-会怎么样-怎么处理" tabindex="-1">问题：如果生产者生产了10条消息，消费者不能一下子接收那么多消息，会怎么样？怎么处理? <a class="header-anchor" href="#问题-如果生产者生产了10条消息-消费者不能一下子接收那么多消息-会怎么样-怎么处理" aria-label="Permalink to “问题：如果生产者生产了10条消息，消费者不能一下子接收那么多消息，会怎么样？怎么处理?”">​</a></h2><p>会出现消息堆积，我们可以开启工作者模式，也就是说弄两个消费者a和b，同时接收消息，a接收1，3，5 。b接收2，4，6。这样的话就可以均匀接收消息了，哪怕有个消费者挂了，也还有消费者接收消息</p><p>消费者：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>// 监听工作消息</span></span>
<span class="line"><span>// 消费者a</span></span>
<span class="line"><span>@RabbitListener(queuesToDeclare = @Queue(&quot;work.queue&quot;)) //MQ中没有队列，所以我们这里创建一个</span></span>
<span class="line"><span>public void listenWorkQueue1(String msg)throws Exception{</span></span>
<span class="line"><span>    System.out.println(&quot;消费者1接收：&quot;+msg);</span></span>
<span class="line"><span>    Thread.sleep(20); //延迟时间</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>//消费者b</span></span>
<span class="line"><span>@RabbitListener(queuesToDeclare = @Queue(&quot;work.queue&quot;))</span></span>
<span class="line"><span>public void listenWorkQueue2(String msg)throws Exception{</span></span>
<span class="line"><span>    System.err.println(&quot;消费者2接收：&quot;+msg);</span></span>
<span class="line"><span>    Thread.sleep(200);//延迟时间</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>但是这里虽然分配给了两个消费者，但是没有考虑到消费者的处理能力和性能的差异化，所以这里我们设置prefetch来控制消费者预取的数量，在消费者的配置文件中添加</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>spring:</span></span>
<span class="line"><span>  rabbitmq:</span></span>
<span class="line"><span>    listener:</span></span>
<span class="line"><span>      simple:</span></span>
<span class="line"><span>        prefetch: 1 # 消费者一次处理一条消息，处理完毕后再从MQ中获取</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-7011f0d8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/java/project.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>Java项目</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/java/mybatis.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>Mybatis</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-1df9f90f data-v-c3855bb3><div class="container" data-v-c3855bb3><p class="message" data-v-c3855bb3><img src="/images/03.png" alt="Logo" style="height: 180px; vertical-align: middle; margin-right: 8px;"> hello world</p><p class="copyright" data-v-c3855bb3>© 2025 本博客已省略 9999 个 bug</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"admin_my.md\":\"BBDaMPgD\",\"dev_docker.md\":\"CZ1Ows3t\",\"dev_mysql.md\":\"B9i0tOVS\",\"dev_nginx.md\":\"BYrY6LqE\",\"dev_redis.md\":\"8QFZQHWt\",\"index.md\":\"C8ZZ54zT\",\"java_bitmap.md\":\"Da1EIbqE\",\"java_dt.md\":\"B9oHvMn7\",\"java_es.md\":\"CbGsdVa3\",\"java_index.md\":\"B8trZM9W\",\"java_java.md\":\"D0bYkbBw\",\"java_mp.md\":\"D77jeMbt\",\"java_mq.md\":\"6nIMkIhz\",\"java_mqtt.md\":\"CBxS-T0R\",\"java_mybatis.md\":\"cx4fa_tH\",\"java_opensource.md\":\"B_KSq-C7\",\"java_project.md\":\"Dl41NjUO\",\"java_spring.md\":\"BYI60RGT\",\"java_springcache.md\":\"DLKoybBt\",\"java_springcloud.md\":\"CIOOmLFk\",\"java_springtask.md\":\"ctM-9Lty\",\"java_websocket.md\":\"N6rrX5BY\",\"linux_index.md\":\"CxIpGxZX\",\"linux_linux.md\":\"Bs0mqmQI\",\"utils_ai.md\":\"DV0BtycB\",\"utils_index.md\":\"0vgYDxqf\",\"utils_movie.md\":\"bltkneiK\",\"utils_pdl.md\":\"u3a8y3Ew\",\"utils_util.md\":\"BDGzHmF7\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"我的博客\",\"description\":\"德智体美劳全面发展\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"关于\",\"link\":\"/admin/my\"},{\"text\":\"潘多拉\",\"link\":\"/utils/index\"},{\"text\":\"Java\",\"link\":\"/java/index\"},{\"text\":\"Linux\",\"link\":\"/linux/index\"},{\"text\":\"组件\",\"items\":[{\"text\":\"MySql\",\"link\":\"/dev/mysql\"},{\"text\":\"Nginx\",\"link\":\"/dev/nginx\"},{\"text\":\"Redis\",\"link\":\"/dev/redis\"},{\"text\":\"Docker\",\"link\":\"/dev/docker\"}]}],\"search\":{\"provider\":\"local\"},\"outlineTitle\":\"页面导航\",\"footer\":{\"message\":\"<img src=\\\"/images/03.png\\\" alt=\\\"Logo\\\" style=\\\"height: 180px; vertical-align: middle; margin-right: 8px;\\\"> hello world\",\"copyright\":\"© 2025 本博客已省略 9999 个 bug\"},\"sidebar\":{\"/\":[],\"/utils/\":[{\"text\":\"概览\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Ai\",\"link\":\"/utils/ai\"},{\"text\":\"影视\",\"link\":\"/utils/movie\"},{\"text\":\"工具\",\"link\":\"/utils/util\"},{\"text\":\"潘多拉\",\"link\":\"/utils/pdl\"}]}],\"/java/\":[{\"text\":\"概览\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Java基础\",\"link\":\"/java/java\"},{\"text\":\"开源框架\",\"link\":\"/java/openSource\"},{\"text\":\"MybatisPlus\",\"link\":\"/java/mp\"},{\"text\":\"SpringCloud\",\"link\":\"/java/springCloud\"},{\"text\":\"WebSocket\",\"link\":\"/java/webSocket\"},{\"text\":\"SpringCache\",\"link\":\"/java/springCache.md\"},{\"text\":\"位图\",\"link\":\"/java/bitmap\"},{\"text\":\"Spring\",\"link\":\"/java/spring\"},{\"text\":\"MQTT\",\"link\":\"/java/mqtt\"},{\"text\":\"SpringTask\",\"link\":\"/java/springTask\"},{\"text\":\"ES\",\"link\":\"/java/es\"},{\"text\":\"分布式事务\",\"link\":\"/java/dt\"},{\"text\":\"Java项目\",\"link\":\"/java/project\"},{\"text\":\"MQ\",\"link\":\"/java/mq\"},{\"text\":\"Mybatis\",\"link\":\"/java/mybatis\"}]}],\"/linux/\":[{\"text\":\"Linux基础\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"常用命令\",\"link\":\"/linux/commands\"},{\"text\":\"文件系统\",\"link\":\"/linux/filesystem\"},{\"text\":\"权限管理\",\"link\":\"/linux/permissions\"}]},{\"text\":\"Linux高级\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Shell脚本\",\"link\":\"/linux/shell\"},{\"text\":\"系统管理\",\"link\":\"/linux/administration\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>