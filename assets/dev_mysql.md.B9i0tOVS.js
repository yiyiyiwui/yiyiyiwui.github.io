import{_ as s,c as n,o as e,ah as i}from"./chunks/framework.kZi0S3Z0.js";const g=JSON.parse('{"title":"mysql","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"dev/mysql.md","filePath":"dev/mysql.md"}'),l={name:"dev/mysql.md"};function t(p,a,h,r,d,c){return e(),n("div",null,[...a[0]||(a[0]=[i(`<h1 id="mysql" tabindex="-1">mysql <a class="header-anchor" href="#mysql" aria-label="Permalink to “mysql”">​</a></h1><h2 id="🔍-查询优化类" tabindex="-1">🔍 查询优化类 <a class="header-anchor" href="#🔍-查询优化类" aria-label="Permalink to “🔍 查询优化类”">​</a></h2><h3 id="复制表结构-不含数据" tabindex="-1">复制表结构（不含数据） <a class="header-anchor" href="#复制表结构-不含数据" aria-label="Permalink to “复制表结构（不含数据）”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>CREATE TABLE new_table LIKE old_table;</span></span></code></pre></div><h3 id="复制表结构-数据" tabindex="-1">复制表结构 + 数据 <a class="header-anchor" href="#复制表结构-数据" aria-label="Permalink to “复制表结构 + 数据”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>CREATE TABLE backup_table AS</span></span>
<span class="line"><span>SELECT * FROM original_table;</span></span></code></pre></div><h3 id="计算两个日期之间的天数" tabindex="-1">计算两个日期之间的天数 <a class="header-anchor" href="#计算两个日期之间的天数" aria-label="Permalink to “计算两个日期之间的天数”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>SELECT DATEDIFF(&#39;2025-12-31&#39;, &#39;2025-01-01&#39;) AS days_diff;</span></span></code></pre></div><h3 id="查询某字段的平均值、最大值、最小值" tabindex="-1">查询某字段的平均值、最大值、最小值 <a class="header-anchor" href="#查询某字段的平均值、最大值、最小值" aria-label="Permalink to “查询某字段的平均值、最大值、最小值”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>SELECT </span></span>
<span class="line"><span>    AVG(price) AS avg_price,</span></span>
<span class="line"><span>    MAX(price) AS max_price,</span></span>
<span class="line"><span>    MIN(price) AS min_price,</span></span>
<span class="line"><span>    COUNT(*) AS total</span></span>
<span class="line"><span>FROM products;</span></span></code></pre></div><h3 id="删除重复数据-保留每个-name-type-中-id-最大的一条-即最新的" tabindex="-1">删除重复数据，保留每个 (name, type) 中 id 最大的一条（即最新的） <a class="header-anchor" href="#删除重复数据-保留每个-name-type-中-id-最大的一条-即最新的" aria-label="Permalink to “删除重复数据，保留每个 (name, type) 中 id 最大的一条（即最新的）”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>DELETE t1 FROM your_table_name t1</span></span>
<span class="line"><span>INNER JOIN your_table_name t2</span></span>
<span class="line"><span>WHERE </span></span>
<span class="line"><span>    t1.name = t2.name</span></span>
<span class="line"><span>    AND t1.type = t2.type</span></span>
<span class="line"><span>    AND t1.id &lt; t2.id;</span></span></code></pre></div><h3 id="查找完全重复的整行数据" tabindex="-1">查找完全重复的整行数据 <a class="header-anchor" href="#查找完全重复的整行数据" aria-label="Permalink to “查找完全重复的整行数据”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 查找哪些 email 出现了超过一次</span></span>
<span class="line"><span>SELECT email, COUNT(*) AS count</span></span>
<span class="line"><span>FROM users</span></span>
<span class="line"><span>GROUP BY email</span></span>
<span class="line"><span>HAVING COUNT(*) &gt; 1;</span></span></code></pre></div><h3 id="快速修改大表结构" tabindex="-1">快速修改大表结构 <a class="header-anchor" href="#快速修改大表结构" aria-label="Permalink to “快速修改大表结构”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 添加列（在线操作，不影响业务）</span></span>
<span class="line"><span>ALTER TABLE large_table </span></span>
<span class="line"><span>ADD COLUMN new_column INT DEFAULT 0,</span></span>
<span class="line"><span>ALGORITHM=INPLACE, LOCK=NONE;</span></span></code></pre></div><h3 id="死锁排查" tabindex="-1">死锁排查 <a class="header-anchor" href="#死锁排查" aria-label="Permalink to “死锁排查”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 查看最近死锁信息</span></span>
<span class="line"><span>SHOW ENGINE INNODB STATUS;</span></span></code></pre></div><h3 id="监控长事务" tabindex="-1">监控长事务 <a class="header-anchor" href="#监控长事务" aria-label="Permalink to “监控长事务”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 查看运行时间超过60秒的事务</span></span>
<span class="line"><span>SELECT * FROM information_schema.innodb_trx </span></span>
<span class="line"><span>WHERE TIME_TO_SEC(TIMEDIFF(NOW(), trx_started)) &gt; 60;</span></span></code></pre></div><h3 id="查找完全重复的整行数据-1" tabindex="-1">查找完全重复的整行数据 <a class="header-anchor" href="#查找完全重复的整行数据-1" aria-label="Permalink to “查找完全重复的整行数据”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 查找哪些 email 出现了超过一次</span></span>
<span class="line"><span>SELECT email, COUNT(*) AS count</span></span>
<span class="line"><span>FROM users</span></span>
<span class="line"><span>GROUP BY email</span></span>
<span class="line"><span>HAVING COUNT(*) &gt; 1;</span></span></code></pre></div><h2 id="🛠️-数据维护类" tabindex="-1">🛠️ 数据维护类 <a class="header-anchor" href="#🛠️-数据维护类" aria-label="Permalink to “🛠️ 数据维护类”">​</a></h2><h3 id="备份表" tabindex="-1">备份表 <a class="header-anchor" href="#备份表" aria-label="Permalink to “备份表”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 1.创建空表结构</span></span>
<span class="line"><span>CREATE TABLE tab_name_2025 LIKE tab_name;</span></span>
<span class="line"><span>-- 2.插入数据</span></span>
<span class="line"><span>INSERT INTO tab_name_2025</span></span>
<span class="line"><span>SELECT * FROM tab_name;</span></span>
<span class="line"><span>-- 3.清空表数据并重置自增主键</span></span>
<span class="line"><span>TRUNCATE TABLE tab_name;</span></span>
<span class="line"><span>-- 4.复制部分数据到新表</span></span>
<span class="line"><span>INSERT INTO tab_name_2025 SELECT * FROM tab_name_2025 where genre =&#39;&#39;;</span></span></code></pre></div><h3 id="查询最近-7-天的数据" tabindex="-1">查询最近 7 天的数据 <a class="header-anchor" href="#查询最近-7-天的数据" aria-label="Permalink to “查询最近 7 天的数据”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>SELECT * FROM orders</span></span>
<span class="line"><span>WHERE created_at &gt;= DATE_SUB(NOW(), INTERVAL 7 DAY);</span></span></code></pre></div><h3 id="按天-月统计数据量" tabindex="-1">按天/月统计数据量 <a class="header-anchor" href="#按天-月统计数据量" aria-label="Permalink to “按天/月统计数据量”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 按天统计</span></span>
<span class="line"><span>SELECT DATE(created_at) AS day, COUNT(*) AS count</span></span>
<span class="line"><span>FROM orders</span></span>
<span class="line"><span>GROUP BY day</span></span>
<span class="line"><span>ORDER BY day;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-- 按月统计</span></span>
<span class="line"><span>SELECT DATE_FORMAT(created_at, &#39;%Y-%m&#39;) AS month, COUNT(*) AS count</span></span>
<span class="line"><span>FROM orders</span></span>
<span class="line"><span>GROUP BY month;</span></span></code></pre></div><h3 id="快速清空大表-比-delete-快" tabindex="-1">快速清空大表（比 DELETE 快） <a class="header-anchor" href="#快速清空大表-比-delete-快" aria-label="Permalink to “快速清空大表（比 DELETE 快）”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>TRUNCATE TABLE large_table;</span></span></code></pre></div><h2 id="📊-数据分析类" tabindex="-1">📊 数据分析类 <a class="header-anchor" href="#📊-数据分析类" aria-label="Permalink to “📊 数据分析类”">​</a></h2><h3 id="表空间分析" tabindex="-1">表空间分析 <a class="header-anchor" href="#表空间分析" aria-label="Permalink to “表空间分析”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 查看各表占用空间</span></span>
<span class="line"><span>SELECT </span></span>
<span class="line"><span>    table_name,</span></span>
<span class="line"><span>    ROUND((data_length + index_length) / 1024 / 1024, 2) AS &#39;Size (MB)&#39;</span></span>
<span class="line"><span>FROM information_schema.tables </span></span>
<span class="line"><span>WHERE table_schema = &#39;your_database&#39;</span></span>
<span class="line"><span>ORDER BY (data_length + index_length) DESC;</span></span></code></pre></div><h3 id="连接数监控" tabindex="-1">连接数监控 <a class="header-anchor" href="#连接数监控" aria-label="Permalink to “连接数监控”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 查看当前连接数和使用情况</span></span>
<span class="line"><span>SHOW PROCESSLIST;</span></span></code></pre></div><h2 id="📝-实用小技巧" tabindex="-1">📝 实用小技巧 <a class="header-anchor" href="#📝-实用小技巧" aria-label="Permalink to “📝 实用小技巧”">​</a></h2><h3 id="随机抽取数据" tabindex="-1">随机抽取数据 <a class="header-anchor" href="#随机抽取数据" aria-label="Permalink to “随机抽取数据”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 随机抽取10条记录</span></span>
<span class="line"><span>SELECT * FROM users ORDER BY RAND() LIMIT 10;</span></span></code></pre></div><h3 id="随机抽取数据-1" tabindex="-1">随机抽取数据 <a class="header-anchor" href="#随机抽取数据-1" aria-label="Permalink to “随机抽取数据”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 随机抽取10条记录</span></span>
<span class="line"><span>SELECT * FROM users ORDER BY RAND() LIMIT 10;</span></span></code></pre></div><h3 id="随机抽取数据-2" tabindex="-1">随机抽取数据 <a class="header-anchor" href="#随机抽取数据-2" aria-label="Permalink to “随机抽取数据”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 随机抽取10条记录</span></span>
<span class="line"><span>SELECT * FROM users ORDER BY RAND() LIMIT 10;</span></span></code></pre></div><h3 id="随机抽取数据-3" tabindex="-1">随机抽取数据 <a class="header-anchor" href="#随机抽取数据-3" aria-label="Permalink to “随机抽取数据”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>-- 随机抽取10条记录</span></span>
<span class="line"><span>SELECT * FROM users ORDER BY RAND() LIMIT 10;</span></span></code></pre></div><h2 id="🔧-运维监控类" tabindex="-1">🔧 运维监控类 <a class="header-anchor" href="#🔧-运维监控类" aria-label="Permalink to “🔧 运维监控类”">​</a></h2>`,46)])])}const b=s(l,[["render",t]]);export{g as __pageData,b as default};
